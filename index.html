<!DOCTYPE html>
<html>
	<title>Phonegap App</title>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
		<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="./cordova.js"></script>
		<script>

			// takes the form field value and returns true on valid number
			//source:http://stackoverflow.com/questions/12310837/implementation-of-luhn-algorithm

			function verifyCard() {
			var value = null;
			value = $("#creditNumber").val();
			//alert(value);

			// accept only digits, dashes or spaces
			    if (/[^0-9-\s]+/.test(value))
			    {
			    	alert("Invalid characters found !! Re-enter your card number");
			    	return false;
			   	}

			// The Luhn Algorithm.
			    var nCheck = 0, nDigit = 0, bEven = false;
			    value = value.replace(/\D/g, "");

			    for (var n = value.length - 1; n >= 0; n--) {
			        var cDigit = value.charAt(n),
			            nDigit = parseInt(cDigit, 10);

			        if (bEven) {
			            if ((nDigit *= 2) > 9) nDigit -= 9;
			        }

			        nCheck += nDigit;
			        bEven = !bEven;
			    }

			    //return (nCheck % 10) == 0;
			    if ((nCheck % 10) == 0){
					$.mobile.changePage("#validPage",{reverse: false, transition:"flip"});
					return true;
			    }
			    else{
			    	$.mobile.changePage("#invalidPage",{reverse: false, transition:"flip"});
			    	return false;
			    }
			}

		</script>
		<style>
			.bgmImage {
			    background: url("./bgm.jpg") no-repeat;
				background-size: 100% auto;
			}

			.norm{color:green}

			p{color:#FE2E2E}
		</style>
	</head>
	<body>
		<!-- Start of page1 -->
		<div data-role="page" id="loginPage">
			<!-- Header -->
			<div data-role="header">
				<h1> Phonegap App </h1>
			</div>
			<!-- /header -->
			<!-- Content    -->
			<div class="bgmImage">
			<div data-role="content">

				<center>
				<p><b>Welcome to Home page!</b><br/></p>
				<a href="#paymentPage" data-transition="flip"> Click here to enter card details </a>
				</center>
				</div>
			</div>
			<!-- footer -->
			<div data-role="footer">
				<h4>&copy; Madhu Anandan </h4>
			</div>
			<!-- /footer -->
		</div>
		<!-- /page -->

		<!-- Start of page2 -->
		<div data-role="page" id="paymentPage">
			<!-- Header -->
			<div data-role="header">
				<h1> Payments </h1>
			</div>
			<!-- /header -->
			<!-- Content    -->
			<div class="bgmImage">
				<div data-role="content">
				<form method="POST" onSubmit = "return verifyCard()" data-ajax="false">
					<input name = "ccnum" id="creditNumber" type="text" placeholder = "Credit card number" required>
					<input type = "submit" value = "Submit">
				</form>
				</div>
			</div>
			<!-- footer -->
			<div data-role="footer">
				<h4>&copy; Madhu Anandan</h4>
			</div>
			<!-- /footer -->
		</div>
		<!-- /page -->

		<!-- Start of page3 -->
		<div data-role="page" id="validPage">
			<!-- Header -->
			<div data-role="header">
				<h1> Valid Credentials </h1>
			</div>
			<!-- /header -->
			<!-- Content    -->
			<div data-role="content">
				<div id="output">
				</div>
				<div class="ui-content">
					<center>
					<p class="norm"> Success!! It is a valid Credit Card Number </br></p>
					<a href="#paymentPage" data-transition="slidefade">Click here to try again</a>
					</center>
				</div>
			</div>
			<!-- /content -->
			<!-- footer -->
			<div data-role="footer">
				<h4>&copy; Madhu Anandan</h4>
			</div>
			<!-- /footer -->
		</div>
		<!-- /page -->

		<!-- Start of page4 -->
		<div data-role="page" id="invalidPage">
			<!-- Header -->
			<div data-role="header">
				<h1> Invalid Credentials </h1>
			</div>
			<!-- /header -->
			<!-- Content    -->
			<div data-role="content">
				<center>
				<p>Invalid Credentials!!!<br/>
				<a href="#paymentPage" data-transition="slidefade">Click here to try again</a></p>
				</center>
			</div>
			<!-- /content -->
			<!-- footer -->
			<div data-role="footer">
				<h4>&copy; Madhu Anandan</h4>
			</div>
			<!-- /footer -->
		</div>
		<!-- /page -->

	</body>
</html>
